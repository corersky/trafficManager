/*!
 * 通用公共方法
 */
$(document).ready(function() {
	try {
		$("a").bind("focus", function() {
			if (this.blur) {
				this.blur()
			}
		});
		$('.datepicker').datepicker({format: "yyyy-mm-dd",language: "zh-CN",clearBtn: true,todayHighlight: true,autoclose: true,orientation: "top auto"});
	} catch (a) {
	}
});
function include(c, m, e) {
	if (document.getElementById(c) == null) {
		var a = typeof e == "string" ? [ e ] : e;
		for (var f = 0; f < a.length; f++) {
			var b = a[f].replace(/^\s|\s$/g, "");
			var h = b.split(".");
			var d = h[h.length - 1].toLowerCase();
			var k = d == "css";
			var l = k ? "link" : "script";
			var g = k ? " type='text/css' rel='stylesheet' "
					: " type='text/javascript' ";
			var j = (k ? "href" : "src") + "='" + m + b + "'";
			document.write("<" + l + (f == 0 ? " id=" + c : "") + g + j + "></"
					+ l + ">")
		}
	}
}
function getQueryString(b, a) {
	var c = new RegExp("(^|&)" + b + "=([^&]*)(&|$)", "i");
	if (a == "") {
		a = window.location.search
	} else {
		a = a.substring(a.indexOf("?"))
	}
	r = a.substr(1).match(c);
	if (r != null) {
		return unescape(r[2])
	}
	return null
}
function getDictLabel(d, c, a) {
	for (var b = 0; b < d.length; b++) {
		var e = d[b];
		if (e.value == c) {
			return e.label
		}
	}
	return a
}
function windowOpen(d, c, e, a) {
	var g = parseInt((window.screen.height - a) / 2, 10), f = parseInt(
			(window.screen.width - e) / 2, 10), b = "location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes,width="
			+ e + ",height=" + a + ",top=" + g + ",left=" + f;
	window.open(d, c, b)
}
function resetTip() {
	top.$.jBox.tip.mess = null
}
function closeTip() {
	top.$.jBox.closeTip()
}
function showTip(d, b, c, a) {
	resetTip();
	setTimeout(function() {
		top.$.jBox.tip(d, (b == undefined || b == "" ? "info" : b), {
			opacity : 0,
			timeout : c == undefined ? 2000 : c
		})
	}, a == undefined ? 500 : a)
}
function loading(a) {
	if (a == undefined || a == "") {
		a = "正在提交，请稍等..."
	}
	resetTip();
	top.$.jBox.tip(a, "loading", {
		opacity : 0
	})
}
function alertx(b, a) {
	top.$.jBox.info(b, "提示", {
		closed : function() {
			if (typeof a == "function") {
				a()
			}
		}
	});
	top.$(".jbox-body .jbox-icon").css("top", "55px")
}

function showJboxMsg(msg,type) {
	top.$.jBox.tip.mess=1;
	top.$.jBox.tip(msg,type,{persistent:true,opacity:0});
}
function confirmx(c, b, a) {
	top.$.jBox.confirm(c, "系统提示", function(d, e, g) {
		if (d == "ok") {
			if (typeof b == "function") {
				b()
			} else {
				resetTip();
				location = b
			}
		}
	}, {
		buttonsFocus : 1,
		closed : function() {
			if (typeof a == "function") {
				a()
			}
		}
	});
	top.$(".jbox-body .jbox-icon").css("top", "55px");
	return false
}
function promptx(d, c, b, a) {
	top.$.jBox(
			"<div class='form-search' style='padding:20px;text-align:center;'>"
					+ c + "：<input type='text' id='txt' name='txt'/></div>", {
				title : d,
				submit : function(e, g, i) {
					if (i.txt == "") {
						top.$.jBox.tip("请输入" + c + "。", "error");
						return false
					}
					if (typeof b == "function") {
						b()
					} else {
						resetTip();
						location = b + encodeURIComponent(i.txt)
					}
				},
				closed : function() {
					if (typeof a == "function") {
						a()
					}
				}
			});
	return false
}
function addTabPage(e, a, d, c, b) {
	top.$.fn.jerichoTab.addTab({
		tabFirer : c,
		title : e,
		closeable : d == undefined,
		data : {
			dataType : "iframe",
			dataLink : a
		}
	}).loadData(b != undefined)
}
function cookie(b, j, m) {
	if (typeof j != "undefined") {
		m = m || {};
		if (j === null) {
			j = "";
			m.expires = -1
		}
		var e = "";
		if (m.expires
				&& (typeof m.expires == "number" || m.expires.toUTCString)) {
			var f;
			if (typeof m.expires == "number") {
				f = new Date();
				f.setTime(f.getTime() + (m.expires * 24 * 60 * 60 * 1000))
			} else {
				f = m.expires
			}
			e = "; expires=" + f.toUTCString()
		}
		var l = m.path ? "; path=" + m.path : "";
		var g = m.domain ? "; domain=" + m.domain : "";
		var a = m.secure ? "; secure" : "";
		document.cookie = [ b, "=", encodeURIComponent(j), e, l, g, a ]
				.join("")
	} else {
		var d = null;
		if (document.cookie && document.cookie != "") {
			var k = document.cookie.split(";");
			for (var h = 0; h < k.length; h++) {
				var c = jQuery.trim(k[h]);
				if (c.substring(0, b.length + 1) == (b + "=")) {
					d = decodeURIComponent(c.substring(b.length + 1));
					break
				}
			}
		}
		return d
	}
}
function pad(b, c) {
	var a = b.toString().length;
	while (a < c) {
		b = "0" + b;
		a++
	}
	return b
}
function strToDate(a) {
	return new Date(a.replace(/-/g, "/"))
}
function addDate(a, b) {
	a = a.valueOf();
	a = a + b * 24 * 60 * 60 * 1000;
	return new Date(a)
};

function showMsg(content,ctype){
	if(!top.$.jBox.tip.mess){
		top.$.jBox.tip.mess=1;
		top.$.jBox.tip(content,ctype,{persistent:true,opacity:0});
		$("#messageBox").show();
	}
}

function detailRecord(i){
	$("#row"+i+'_detail').toggle();
}


function switchSearch(obj){
	$('#advancedSearchDiv').slideToggle('fast',function(){
		if($(this).css("display")=="none"){
			$(obj).empty().append("展开高级搜索");
			$("#SearchKeyWord").show();
			$("#searchButton").show();
		}else {
			$(obj).empty().append("收起高级搜索");
			$("#SearchKeyWord").hide();
			$("#searchButton").hide();
		}
	});
	$('.search').slideToggle('fast');
}

function resetSearch(){
	$("#advancedSearchDiv").find("input").each(function(){
		this.value = '';
	});
	$("#advancedSearchDiv").find("select").each(function(){
		this.value = '';
	});
}
function load(){
	$("#SearchKeyWord").val($.trim($("#SearchKeyWord").val()));
	$("#resultList").flexReload(myPage,true);
	$("#selectAllCheckbox").removeAttr("checked");
}

function parentCancelReload() {
	load();
}

function refresh_page() {
	$("#SearchKeyWord").val("");
	load();
}

function search(){
	$("#resultList").flexReload(myPage);
}

// 取得选中的id列表
function getSelectIds() {
	var cids = "";
	var selCtrls = $("input[listcheck='0']:checked");
	var id_len = selCtrls.length;
	for (var i = 0; i < id_len; i++) {
		if(i==0){
			cids += selCtrls[i].value ;
		} else {
			cids += ','+selCtrls[i].value;
		}
	}
	return cids;
}

function doCommonSave() {
	$("#myForm").submit();
	if($("#myForm").find(".n-error:visible").length>0){
		return;
	}
	var param = $('#myForm').serializeObject(); 
	var moduleName = $("#moduleName").val();
	$.YY_post(moduleName+"/save.json", param, function(result, resultState) {
		if (resultState == "success") {
			if (result.serviceResult.statu == 1) {
				showMsg(result.serviceResult.message);
				refresh_page();
			} else {
				showErrorMsg(result.serviceResult.message);
			}
		} else {
			showErrorMsg("操作失败");
		}
	});
}


function deleteSel(id){//删除单行值传ID，否则不传值或者null
	var moduleName = $("#moduleName").val();
	var ids ;
	if(id==null||id==undefined||id=="undefined"){
		ids = getSelectIds();
	} else {
		ids = id;
	}
	if (ids == '' ) {
		showMsg("请选择要操作的数据");
		return;
	}
	if (!confirm("您确定要删除吗？")) {
		return;
	}
	var param = {};
	param[moduleName+"Id"] = ids;
	param["isdel"] = 1;
	$.YY_post(moduleName+"/delete.json", param, function(result, resultState) {
		if (resultState == "success") {
			if (result.serviceResult.statu == 1) {
				showMsg(result.serviceResult.message);
				clearRememberCheckboxMap();
				refresh_page();
			} else {
				showErrorMsg(result.serviceResult.message);
			}
		} else {
			showErrorMsg("删除失败");
		}
	});
}

// 启用或停用
function operateRecord(operateName) {
	var moduleName = $("#moduleName").val();
	var ids = getSelectIds();
	if (ids == '' ) {
		showErrorMsg("请选择要操作的数据");
		return;
	}
	var param = {},msg='';
	if (operateName == "start") {
		param["isstop"] = 0;
		msg="是否启用选中条目?";
	} else if (operateName == "stop") {
		param["isstop"] = 1;
		msg="是否停用选中条目?";
	} else {
		showErrorMsg("参数错误");
		return;
	}
	if (!confirm(msg)) {
		return;
	}
	param[moduleName+"Id"] = ids;

	$.YY_post(moduleName+"/operate.json", param, function(result, resultState) {
		if (resultState == "success") {
			if (result.serviceResult.statu == 1) {
				showMsg(result.serviceResult.message);
				clearRememberCheckboxMap();
				refresh_page();
			} else {
				showErrorMsg(result.serviceResult.message);
			}
		} else {
			showErrorMsg("操作失败");
		}
	});
}

function doExport(){
	var data = $('#advancedSearchForm').serializeArray();
	
}
function getPageParams() {
	if($('#advancedSearchDiv').css("display")=="none"){//普通搜索
		param = $('#normalSearchForm').serializeArray();
		exportparam=param;
		return param;
	} else {//高级搜索
		
		param = $('#advancedSearchForm').serializeArray();
		exportparam=param;
		return param;
	}
}